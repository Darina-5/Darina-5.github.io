<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–ú–æ–π –≤–∏—à–ª–∏—Å—Ç üéÅ</title>
    <style>
        /* –û—Å–Ω–æ–≤–Ω—ã–µ —Å—Ç–∏–ª–∏ */
        body {
            font-family: 'Arial', sans-serif;
            line-height: 1.6;
            max-width: 900px;
            margin: 0 auto;
            padding: 20px;
            color: #333;
            background-color: #f9f9f9;
        }
        
        h1 {
            text-align: center;
            color: #2c3e50;
            margin-bottom: 30px;
        }
        
        /* –°—Ç–∏–ª–∏ –∫–∞—Ä—Ç–æ—á–µ–∫ –ø–æ–¥–∞—Ä–∫–æ–≤ */
        .gift-container {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 20px;
            margin-top: 30px;
        }
        
        .gift-card {
            background: white;
            border-radius: 10px;
            box-shadow: 0 3px 10px rgba(0, 0, 0, 0.1);
            overflow: hidden;
            transition: transform 0.3s ease;
        }
        
        .gift-card:hover {
            transform: translateY(-5px);
        }
        
        .gift-image {
            width: 100%;
            height: 200px;
            object-fit: cover;
            border-bottom: 1px solid #eee;
        }
        
        .gift-info {
            padding: 15px;
        }
        
        .gift-title {
            font-size: 1.2em;
            margin: 0 0 10px 0;
            color: #2c3e50;
        }
        
        .gift-description {
            color: #666;
            margin-bottom: 15px;
            font-size: 0.9em;
        }
        
        .gift-link {
            display: inline-block;
            color: #3498db;
            text-decoration: none;
            margin-bottom: 15px;
            font-size: 0.9em;
        }
        
        .gift-link:hover {
            text-decoration: underline;
        }
        
        /* –°—Ç–∏–ª–∏ –∫–Ω–æ–ø–æ–∫ –∏ —Å—Ç–∞—Ç—É—Å–∞ */
        .reserve-btn {
            background: #2ecc71;
            color: white;
            border: none;
            padding: 8px 15px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 0.9em;
            width: 100%;
            transition: background 0.3s;
        }
        
        .reserve-btn:hover {
            background: #27ae60;
        }
        
        .reserve-btn:disabled {
            background: #95a5a6;
            cursor: not-allowed;
        }
        
        .gift-status {
            margin-top: 10px;
            font-size: 0.8em;
            color: #7f8c8d;
            font-style: italic;
        }
        
        .reserved-by {
            color: #e74c3c;
            font-weight: bold;
        }
        
        /* –õ–æ–∞–¥–µ—Ä –∏ —Å–æ–æ–±—â–µ–Ω–∏—è */
        .loader {
            text-align: center;
            padding: 30px;
            font-size: 1.2em;
            color: #7f8c8d;
        }
        
        .error-message {
            color: #e74c3c;
            text-align: center;
            padding: 20px;
            background: #fdecea;
            border-radius: 5px;
            margin: 20px 0;
        }
        
        /* –ê–¥–∞–ø—Ç–∏–≤–Ω–æ—Å—Ç—å */
        @media (max-width: 600px) {
            .gift-container {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <h1>–ú–æ–π —Å–ø–∏—Å–æ–∫ –∂–µ–ª–∞–Ω–∏–π –Ω–∞ –¥–µ–Ω—å —Ä–æ–∂–¥–µ–Ω–∏—è üéÇ</h1>
    
    <div id="loading" class="loader">–ó–∞–≥—Ä—É–∂–∞–µ–º —Å–ø–∏—Å–æ–∫ –ø–æ–¥–∞—Ä–∫–æ–≤...</div>
    
    <div id="gifts-container" class="gift-container"></div>
    
    <div id="error-container" style="display: none;" class="error-message"></div>
    
    <script>
        // –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è
        const CONFIG = {
            apiUrl: 'https://script.google.com/macros/s/AKfycbwKbrMfly-En4zNleqmZr35GClj6UXjMAB2QEiE9DvMIzlmndNj0AuvME1j3P3Bm_-O/exec',
            defaultImage: 'https://via.placeholder.com/300x200?text=–ü–æ–¥–∞—Ä–æ–∫'
        };
        
        // DOM —ç–ª–µ–º–µ–Ω—Ç—ã
        const giftsContainer = document.getElementById('gifts-container');
        const loadingElement = document.getElementById('loading');
        const errorContainer = document.getElementById('error-container');
        
        // –ó–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö –ø—Ä–∏ –æ—Ç–∫—Ä—ã—Ç–∏–∏ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
        document.addEventListener('DOMContentLoaded', async () => {
            try {
                // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –ª–æ–∞–¥–µ—Ä
                loadingElement.style.display = 'block';
                giftsContainer.style.display = 'none';
                errorContainer.style.display = 'none';
                
                // –ó–∞–≥—Ä—É–∂–∞–µ–º –¥–∞–Ω–Ω—ã–µ
                const gifts = await loadGifts();
                
                // –†–µ–Ω–¥–µ—Ä–∏–º –ø–æ–¥–∞—Ä–∫–∏
                renderGifts(gifts);
                
                // –°–∫—Ä—ã–≤–∞–µ–º –ª–æ–∞–¥–µ—Ä
                loadingElement.style.display = 'none';
                giftsContainer.style.display = 'grid';
            } catch (error) {
                showError('–ù–µ —É–¥–∞–ª–æ—Å—å –∑–∞–≥—Ä—É–∑–∏—Ç—å —Å–ø–∏—Å–æ–∫ –ø–æ–¥–∞—Ä–∫–æ–≤. –ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –ø–æ–ø—Ä–æ–±—É–π—Ç–µ –ø–æ–∑–∂–µ.');
                console.error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏:', error);
            }
        });
        
        // –§—É–Ω–∫—Ü–∏—è –∑–∞–≥—Ä—É–∑–∫–∏ –ø–æ–¥–∞—Ä–∫–æ–≤
        async function loadGifts() {
            const response = await fetch(`${CONFIG.apiUrl}?function=doGetGifts`);
            
            if (!response.ok) {
                throw new Error('–û—à–∏–±–∫–∞ —Å–µ—Ç–∏');
            }
            
            const data = await response.json();
            
            if (data.error) {
                throw new Error(data.message);
            }
            
            return data;
        }
        
        // –§—É–Ω–∫—Ü–∏—è —Ä–µ–Ω–¥–µ—Ä–∏–Ω–≥–∞ –ø–æ–¥–∞—Ä–∫–æ–≤
        function renderGifts(gifts) {
            giftsContainer.innerHTML = '';
            
            if (gifts.length === 0) {
                showError('–°–ø–∏—Å–æ–∫ –ø–æ–¥–∞—Ä–∫–æ–≤ –ø—É—Å—Ç');
                return;
            }
            
            gifts.forEach(gift => {
                const giftCard = document.createElement('div');
                giftCard.className = 'gift-card';
                
                // –ü—Ä–æ–≤–µ—Ä—è–µ–º –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ
                const imageUrl = gift.image || CONFIG.defaultImage;
                
                // –§–æ—Ä–º–∏—Ä—É–µ–º HTML –∫–∞—Ä—Ç–æ—á–∫–∏
                giftCard.innerHTML = `
                    <img src="${imageUrl}" alt="${gift.description}" class="gift-image">
                    <div class="gift-info">
                        <h3 class="gift-title">${gift.description}</h3>
                        <p class="gift-description">${gift.additionalInfo || ''}</p>
                        ${gift.link ? `<a href="${gift.link}" target="_blank" class="gift-link">–ü–æ—Å–º–æ—Ç—Ä–µ—Ç—å –≤ –º–∞–≥–∞–∑–∏–Ω–µ</a>` : ''}
                        <button class="reserve-btn" 
                                onclick="handleReserve(${gift.id}, '${gift.description.replace(/'/g, "\\'")}')"
                                ${gift.status === '–ó–∞–±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω' ? 'disabled' : ''}>
                            ${gift.status === '–ó–∞–±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω' ? '–ó–∞–±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–æ' : '–ó–∞–±—Ä–æ–Ω–∏—Ä–æ–≤–∞—Ç—å'}
                        </button>
                        <div class="gift-status">
                            ${gift.status === '–ó–∞–±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω' 
                                ? `–ó–∞–±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–æ: <span class="reserved-by">${gift.reservedBy}</span>` 
                                : '–î–æ—Å—Ç—É–ø–Ω–æ –¥–ª—è –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è'}
                        </div>
                    </div>
                `;
                
                giftsContainer.appendChild(giftCard);
            });
        }
        
        // –û–±—Ä–∞–±–æ—Ç–∫–∞ –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è
        async function handleReserve(giftId, giftName) {
            const userName = prompt(`–í—ã —Ö–æ—Ç–∏—Ç–µ –∑–∞–±—Ä–æ–Ω–∏—Ä–æ–≤–∞—Ç—å "${giftName}". –í–≤–µ–¥–∏—Ç–µ –≤–∞—à–µ –∏–º—è:`);
            
            if (!userName || userName.trim() === '') {
                alert('–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –≤–≤–µ–¥–∏—Ç–µ –≤–∞—à–µ –∏–º—è');
                return;
            }
            
            try {
                const response = await fetch(
                    `${CONFIG.apiUrl}?function=reserveGift&id=${giftId}&user=${encodeURIComponent(userName)}`
                );
                
                const result = await response.json();
                
                if (result.success) {
                    alert(`–ü–æ–¥–∞—Ä–æ–∫ "${result.gift}" —É—Å–ø–µ—à–Ω–æ –∑–∞–±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω –Ω–∞ ${result.user}!`);
                    // –ü–µ—Ä–µ–∑–∞–≥—Ä—É–∂–∞–µ–º —Å–ø–∏—Å–æ–∫
                    const gifts = await loadGifts();
                    renderGifts(gifts);
                } else {
                    alert(`–û—à–∏–±–∫–∞: ${result.message}`);
                }
            } catch (error) {
                alert('–ü—Ä–æ–∏–∑–æ—à–ª–∞ –æ—à–∏–±–∫–∞ –ø—Ä–∏ –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–∏. –ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –ø–æ–ø—Ä–æ–±—É–π—Ç–µ –ø–æ–∑–∂–µ.');
                console.error('–û—à–∏–±–∫–∞ –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è:', error);
            }
        }
        
        // –ü–æ–∫–∞–∑ –æ—à–∏–±–æ–∫
        function showError(message) {
            loadingElement.style.display = 'none';
            giftsContainer.style.display = 'none';
            errorContainer.style.display = 'block';
            errorContainer.textContent = message;
        }
        
        // –î–µ–ª–∞–µ–º —Ñ—É–Ω–∫—Ü–∏–∏ –≥–ª–æ–±–∞–ª—å–Ω—ã–º–∏ –¥–ª—è –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–æ–≤ —Å–æ–±—ã—Ç–∏–π
        window.handleReserve = handleReserve;
    </script>
</body>
</html>
